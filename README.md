## Card-Roguelike MVP

Card-Roguelike — 2D roguelike-игра с карточной механикой, где игрок перемещается по **процедурно генерируемым комнатам**, сражается с врагами и собирает предметы. Игровое поле представлено в виде карт, которые игрок открывает по мере продвижения.

<iframe width="560" height="315" src="https://www.youtube.com/embed/qgbWs7FbNJE?si=zg3xA5U-XgLvgawA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

https://youtu.be/qgbWs7FbNJE

## Технологический стек

### Движок и версия
- **Unity 2022.3.11f1**
- **C# (.NET)**

### Основные библиотеки и плагины
- **DOTween** — анимации и твининг
- **Feel (MMFeedbacks)** — система фидбеков и визуальных эффектов
- **Odin Inspector** — расширенный инспектор для Unity Editor
- **TextMesh Pro** — продвинутая работа с текстом
- **Newtonsoft.Json** — сериализация данных
- **JetBrains Annotations** — аннотации для улучшения качества кода

### Внешние ассеты
- Pixel Art спрайты (Bandits, Enemy Galore, Bringer Of Death)
- Cainos Pixel Art Icon Pack
- Feel Demo Assets

## Архитектурные подходы

### Паттерны проектирования

**State Machine**
- Управление игровым циклом через конечный автомат состояний
- Состояния: `PlayerPositioningState`, `PlayerTurnState`, `OpenCardsState`, `CardsAttackState`
- Каждое состояние имеет методы `Enter()`, `Execute()`, `Exit()` и `Process()`

**Factory Pattern**
- Фабрики для создания различных типов карт: `EnemyFactory`, `ItemFactory`, `BlockFactory`, `EffectCardsFactory`, `PlacementFactory`, `DeckCardFactory`
- Централизованное создание игровых объектов с инициализацией

**Component-Based Architecture**
- Использование компонентного подхода Unity
- Разделение логики на независимые компоненты: `Health`, `TurnEffectsHandler`, `DirectionAttacker`, `DragAndDropObject`

**Event-Driven Architecture**
- Система событий для слабой связанности компонентов
- События: `EventTurnEnded`, `OnHealthZero`, `DeathPerformed`, `CoinsAdded`

**Strategy Pattern**
- `EffectMapper` — маппинг эффектов на методы применения
- Различные типы эффектов обрабатываются через единый интерфейс

### Структура проекта

```
Assets/
├── Scripts/
│   ├── Cards/              # Типы карт (Card, DeckCard, EnemyCard, HeroCard, PlayerHeroCard)
│   ├── CardUtilities/      # Утилиты для карт (Health, DeckBuilder, DirectionAttacks)
│   ├── DeckMaster/         # Основная игровая логика и State Machine
│   ├── Effects/            # Система эффектов
│   ├── Player/             # Управление игроком (Input, Camera, Raycaster)
│   ├── UI/                 # Пользовательский интерфейс
│   ├── Data/               # ScriptableObjects и данные
│   ├── SaveLoadSystem/     # Система сохранений
│   └── SceneManagement/    # Управление сценами
├── Scenes/                 # Игровые сцены (MainMenu, Game, LoadingScreen)
├── InternalAssets/         # Внутренние ассеты проекта
└── ExternalAssets/         # Сторонние ассеты
```

### Ключевые архитектурные решения

**Процедурная генерация уровней**
- `DeckBuilder` — алгоритм построения уровня из комнат
- Система соединения комнат через двери с учетом направлений
- Рандомизация расположения врагов, предметов и блоков

**Система карт**
- Базовый класс `Card` с наследованием для разных типов
- `DeckCard` — карты на игровом поле
- `HeroCard` — карты с системой здоровья и эффектов
- `PlayerHeroCard` — управляемая карта игрока

**Система эффектов**
- ScriptableObject-based эффекты
- Типы эффектов: `Instant` и `Turns` (мгновенные и длительные)
- Параметры воздействия: здоровье, щит, монеты
- Визуальные эффекты через Particle System

**Drag & Drop механика**
- Система перетаскивания карты игрока
- Raycast для определения целевых карт
- Визуальная обратная связь при наведении

**Направленные атаки**
- `DirectionAttacker` — система атак врагов в определенных направлениях
- Визуализация зон атаки через спрайты
- Расчет позиций атаки относительно врага

## Реализованный функционал

### Игровая механика

**Система ходов**
- Пошаговое перемещение игрока по картам
- Ограничение радиуса перемещения
- Открытие карт в зоне видимости игрока
- Автоматическая атака врагов после хода игрока

**Боевая система**
- Система здоровья и щита
- Мгновенные и длительные эффекты
- Направленные атаки врагов
- Система урона с учетом щита
- Визуальные эффекты атак и получения урона

**Процедурная генерация**
- Генерация уровня из предустановленных комнат
- Случайное размещение врагов, предметов и препятствий
- Система дверей для соединения комнат
- Настраиваемые вероятности спавна различных типов карт

**Система карт**
- Типы карт: враги, предметы, блоки, двери, пустые клетки
- Открытие карт с анимацией переворота
- Взаимодействие с картами через drag & drop
- Визуальная индикация доступных ходов

**Система прогрессии**
- Сбор монет с убитых врагов
- Счетчик убийств
- Босс-враги
- Условия победы и поражения

### Пользовательский интерфейс

- Отображение здоровья и щита
- Счетчик монет
- Счетчик убийств
- Экран смерти с анимацией
- Экран победы
- Главное меню
- Экран загрузки

### Система камеры

- Автоматическое следование за игроком (опционально)
- Плавное перемещение камеры
- Зум колесиком мыши
- Настраиваемые параметры движения и зума

### Управление

- Drag & Drop мышью для перемещения
- Клавиатурное управление (альтернативное)
- Поддержка различных схем ввода

### Настройки и балансировка

**GameRules ScriptableObject** содержит:
- Параметры игрока (здоровье, радиус перемещения, зона видимости)
- Параметры врагов (зона атаки)
- Параметры генерации (количество комнат, вероятности спавна)
- Параметры камеры
- Параметры анимаций и визуальных эффектов

### Дополнительные возможности

- Система сохранения (частично реализована)
- Загрузка сцен с экраном загрузки
- Перезапуск уровня
- Режим backtracking (возможность возвращаться назад)
- Система overheal (здоровье выше максимума с постепенной потерей)
- Визуальные фидбеки через Feel/MMFeedbacks

### Особенности реализации

- Использование ScriptableObjects для данных
- Singleton-паттерн для глобального доступа к правилам игры
- Статическое хранилище статистики игрока
- Система событий для развязки компонентов
- Анимации через DOTween
- Particle System для визуальных эффектов
- Odin Inspector для удобной настройки в редакторе
